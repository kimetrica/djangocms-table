<div id="table"></div>
<script type="text/javascript">
//<![CDATA]

(function($) {

	{% if data %}
	table_data = {{ data|safe }};
	{% else %}
	table_data = {'mergeCells': [], 'cell': []};
	{% endif %}
	
	$('form').on('submit', function(e) {
	    e.preventDefault();
    	var data = new Object();
    	data.data = hot.getData();
    	data.mergeCells = hot.mergeCells.mergedCellInfoCollection;
    	data.cell = [];
    	for(var i = 0; i < hot.countRows(); i++) {
    		for(var j = 0; j < hot.countCols(); j++) {
    			var metadata = hot.getCellMeta(i, j);
    			for (var property in metadata) {
    				if (metadata.hasOwnProperty(property) && ['className'].indexOf(property) >= 0) {
    			    	var cell = {'row': i, 'col': j};
    					cell[property] = metadata[property];
    					data.cell.push(cell);
    				}
    			}    			
    		}
    	}
    	$("#id_{{ name }}").val(JSON.stringify(data));
	    this.submit();
	});
	
	$(document).ready(function () {
		var container = document.getElementById('table');
		
		headers_top = Number($("#id_headers_top").val());
		headers_bottom = Number($("#id_headers_bottom").val());
		headers_left = Number($("#id_headers_left").val());

		$("#id_headers_top").change(function(){
			headers_top = Number($("#id_headers_top").val());
			hot.render();
		})
		$("#id_headers_bottom").change(function(){
			headers_bottom = Number($("#id_headers_bottom").val());
			hot.render();
		})
		$("#id_headers_left").change(function(){
			headers_left = Number($("#id_headers_left").val());
			hot.render();
		})

	    hot = getTable(container, {});	
  	
	});	 
})(jQuery); 


//]]>
</script>
<style type="text/css">
	#id_{{ name }} { display:none}
</style>
